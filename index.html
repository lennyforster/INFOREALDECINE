<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INFO REAL DE CINE</title>
    <style>
        :root {
            --color-bg: #f5f5f5;
            --color-text: #333;
            --color-header: #8ac0ff;
            --color-header-text: #fff;
            --color-card-bg: #fff;
            --color-card-shadow: rgba(0,0,0,0.1);
            --color-table-th: #8ac0ff;
            --color-table-th-text: #fff;
            --color-table-td-bg: #fff;
            --color-table-td-hover: #f5f9ff;
            --color-btn: #8ac0ff;
            --color-btn-hover: #7ab0ef;
            --color-btn-active: #ffdd00;
            --color-btn-active-text: #333;
            --color-tag-bg: #f0f0f0;
            --color-tag-text: #666;
            --color-popup-bg: #fff;
            --color-popup-text: #333;
            --color-popup-shadow: rgba(0,0,0,0.2);
        }
        body {
            background-color: var(--color-bg);
            color: var(--color-text);
            font-family: 'Helvetica', sans-serif;
            margin: 0;
            padding: 0;
            user-select: none;
        }
        header {
            background-color: var(--color-header);
            color: var(--color-header-text);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
            transition: background-color 0.3s;
        }
        h1 {
            margin: 0;
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        h1:hover {
            transform: scale(1.02);
        }
        .header-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .header-button {
            background-color: transparent;
            color: var(--color-header-text);
            font-size: 16px;
            cursor: pointer;
            border: none;
            font-weight: bold;
            padding: 8px 15px;
            transition: all 0.3s;
            border-radius: 4px;
        }
        .header-button.random-movie,
        .header-button.info {
            background-color: transparent;
            transition: all 0.3s ease;
        }
        .header-button.random-movie:hover,
        .header-button.info:hover {
            background-color: rgba(90, 57, 255, 0.3);
            transform: scale(1.05);
        }
        

        .container {
            width: 90%;
            max-width: 1400px;
            margin: 20px auto;
            scroll-margin-top: 20px;
        }
        .search-bar {
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        .search-bar input {
            flex: 1;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ffdd00;
            border-radius: 6px;
            box-sizing: border-box;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            background-color: #fff;
        }
        .search-bar input:focus {
            outline: none;
            border-color: #8ac0ff;
        }
        .reset-button {
            background-color: transparent;
            color: #8ac0ff;
            border: none;
            padding: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            display: none;
            transition: all 0.3s;
        }
        .reset-button:hover {
            text-decoration: underline;
            transform: scale(1.05);
        }
        /* Vista de tabla */
        .table-view {
            display: none;
        }
        .gallery-view {
            display: block;
        }
        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }
        .view-toggle button {
            background-color: transparent;
            color: var(--color-header-text);
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .view-toggle button:hover {
            background-color: #ffdd00 !important;
            color: #23272a !important;
            transform: translateY(-2px);
        }
        .view-toggle button.active {
            background-color: var(--color-btn-active);
            color: var(--color-btn-active-text);
        }
        /* Estilos para la galer√≠a */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }
        .gallery-pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        .pagination-button {
            background: none !important;
            color: unset !important;
            border: none !important;
            font-size: 2rem;
            font-weight: 900;
            line-height: 1;
            transition: none;
            box-shadow: none !important;
        }
        .pagination-button:hover, .pagination-button:focus {
            color: unset !important;
            background: none !important;
        }
        body.dark-mode .pagination-button {
            color: #fff !important;
        }
        body.dark-mode .pagination-button:hover, body.dark-mode .pagination-button:focus {
            color: #ffdd00 !important;
        }
        .pagination-button.active {
            background-color: var(--color-btn-active);
            color: var(--color-btn-active-text);
        }
        .pagination-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .pagination-info {
            color: #666;
            font-size: 14px;
            margin: 0 15px;
        }
        .gallery-loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .gallery-loading .loading-spinner {
            margin: 0 auto 20px;
        }
        .movie-card {
            background: var(--color-card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px var(--color-card-shadow);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        .movie-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .movie-poster {
            width: 100%;
            height: 300px;
            background-color: #f0f0f0;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .movie-poster::before {
            content: "Cargando...";
            color: #666;
            font-size: 14px;
        }
        .movie-poster.loaded::before {
            display: none;
        }
        .movie-info {
            padding: 15px;
        }
        .movie-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--color-text);
            line-height: 1.3;
        }
        .movie-meta {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
        .movie-director {
            font-weight: bold;
            color: #8ac0ff;
        }
        .movie-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 10px;
        }
        .movie-tag {
            background-color: var(--color-tag-bg);
            color: var(--color-tag-text);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
        }
        .movie-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }
        .movie-actions a {
            flex: 1;
            text-align: center;
            padding: 6px 8px;
            background-color: #8ac0ff;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .movie-actions a:hover {
            background-color: #7ab0ef;
            transform: scale(1.05);
        }
        .new-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ffdd00;
            color: #333;
            font-size: 10px;
            padding: 4px 8px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 2;
        }
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 20px;
            background-color: var(--color-bg);
            transition: background-color 0.4s;
        }
        table th, table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #8ac0ff !important;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 250px;
            background-color: var(--color-bg);
            transition: background-color 0.4s, color 0.4s, border-color 0.4s;
        }
        table thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }
        table tr {
            transition: all 0.3s ease;
        }
        table tbody tr:hover {
            transform: scale(1.01);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 1;
            position: relative;
        }
        table tbody tr:hover td {
            background-color: var(--color-table-td-hover);
        }
        table th {
            background-color: var(--color-table-th);
            color: var(--color-table-th-text);
            position: sticky;
            top: 0;
            z-index: 10;
            transform: none !important;
            cursor: pointer;
            transition: all 0.2s;
        }
        table th:hover {
            background-color: rgba(255, 221, 0, 0.15);
        }
        table th:active {
            transform: scale(0.98) !important;
            background-color: #69a0df;
        }
        .sortable {
            user-select: none;
        }
        .sort-asc::after {
            content: ' ‚Üë';
            opacity: 0.8;
            font-family: sans-serif;
        }
        .sort-desc::after {
            content: ' ‚Üì';
            opacity: 0.8;
            font-family: sans-serif;
        }
        .sortable::after {
            content: ' ‚Üï';
            opacity: 0.8;
            transition: opacity 0.3s;
            font-family: sans-serif;
        }
        .sortable:hover::after {
            opacity: 1;
        }
        .director-link, .movie-link, .letterboxd-link, .year-link, .tag-link {
            text-decoration: none;
            color: inherit;
            cursor: pointer;
            transition: all 0.3s;
        }
        .movie-link:visited, .letterboxd-link:visited {
            color: #8ac0ff !important;
        }
        .director-link:hover, .movie-link:hover, .letterboxd-link:hover, .year-link:hover, .tag-link:hover {
            color: #8ac0ff;
        }
        .tag-link {
            display: inline-block;
            margin: 2px;
            padding: 2px 6px;
            background-color: var(--color-tag-bg);
            border-radius: 12px;
            font-size: 0.9em;
        }
        .tag-link:hover {
            background-color: #e0e0e0;
        }
        .visited-link {
            color: #8ac0ff !important;
        }
        .new-movie {
            position: relative;
        }
        .new-movie::after {
            content: 'NUEVO';
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ffdd00;
            color: #333;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        .loading-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #8ac0ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #infoPopup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--color-popup-bg);
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 20px var(--color-popup-shadow);
            max-width: 400px;
            width: 90%;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        #infoPopup.visible {
            opacity: 1;
        }
        #infoPopup .popup-content {
            font-size: 16px;
            color: var(--color-popup-text);
        }
        #closeInfoButton {
            background-color: transparent;
            border: none;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            top: 10px;
            right: 10px;
            color: #8ac0ff;
            transition: all 0.3s;
        }
        #closeInfoButton:hover {
            color: #888;
            transform: scale(1.1);
        }
        #infoPopup .popup-content a {
            color: #8ac0ff;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
        }
        #infoPopup .popup-content a:hover {
            color: #5a90df;
        }
        .scroll-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #8ac0ff;
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: none;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        .scroll-to-top.visible {
            opacity: 1;
            visibility: visible;
        }
        .scroll-to-top:hover {
            background-color: #7ab0ef;
            transform: translateY(-2px);
        }
        /* Estilos para el popup de pel√≠cula */
        #moviePopup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #moviePopup.visible {
            opacity: 1;
        }
        #closeMovieButton {
            position: absolute;
            top: 20px;
            right: 30px;
            background: none;
            border: none;
            color: white;
            font-size: 30px;
            cursor: pointer;
            z-index: 1001;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }
        #closeMovieButton:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        .movie-popup-content {
            background: var(--color-popup-bg);
            color: var(--color-popup-text);
            border-radius: 15px;
            max-width: 900px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }
        #moviePopup.visible .movie-popup-content {
            transform: scale(1);
        }
        .movie-popup-poster {
            flex: 0 0 300px;
            background-color: #f0f0f0;
            position: relative;
        }
        .movie-popup-poster-img {
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
        }
        .movie-popup-info {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        .movie-popup-title {
            font-size: 28px;
            font-weight: bold;
            color: var(--color-popup-text);
            margin: 0 0 15px 0;
            line-height: 1.2;
        }
        .movie-popup-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            color: var(--color-popup-text);
            font-size: 16px;
        }
        .movie-popup-meta span,
        .movie-popup-meta a {
            padding: 0;
            background: none;
            border-radius: 0;
            font-weight: 400;
            text-decoration: underline;
        }
        body.dark-mode .movie-popup-meta span,
        body.dark-mode .movie-popup-meta a {
            color: #fff;
        }
        body:not(.dark-mode) .movie-popup-meta span,
        body:not(.dark-mode) .movie-popup-meta a {
            color: #23272a;
        }
        .movie-popup-synopsis h3 {
            font-size: 20px;
            color: var(--color-popup-text);
            margin: 0 0 15px 0;
            font-weight: bold;
        }
        .synopsis-text {
            font-size: 16px;
            line-height: 1.6;
            color: var(--color-popup-text);
            margin: 0;
            text-align: justify;
        }
        .movie-popup-actions {
            margin-top: 30px;
            display: flex;
            gap: 15px;
        }
        .movie-popup-actions a {
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s ease;
            display: inline-block;
        }
        .movie-popup-watch {
            background-color: #8ac0ff;
            color: white;
        }
        .movie-popup-watch:hover {
            background-color: #7ab0ef;
            transform: translateY(-2px);
        }
        .movie-popup-letterboxd {
            background-color: #8ac0ff;
            color: white;
        }
        .movie-popup-letterboxd:hover {
            background-color: #7ab0ef;
            color: white;
            transform: translateY(-2px);
        }
        .movie-popup-year a, .movie-popup-director a {
            color: #333;
            text-decoration: none;
            font-weight: normal;
            border-bottom: 1px dashed #bbb;
            transition: color 0.2s, border-bottom 0.2s;
        }
        .movie-popup-year a:hover, .movie-popup-director a:hover {
            color: #8ac0ff;
            border-bottom: 1px solid #8ac0ff;
            cursor: pointer;
        }
        .movie-popup-duration {
            color: var(--color-popup-text);
        }
        @media (max-width: 600px) {
            header {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
                padding: 10px 10px;
                min-height: unset;
            }
            header h1 {
                position: static !important;
                width: auto !important;
                margin: 0;
                text-align: left;
                font-size: 19px;
                flex: 1;
            }
            .header-buttons {
                display: none !important;
            }
            .hamburger {
                display: block !important;
                background: none;
                border: none;
                font-size: 28px;
                color: #fff;
                cursor: pointer;
                margin-left: 10px;
                z-index: 1002;
            }
            .mobile-menu {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: #8ac0ff;
                box-shadow: 0 2px 8px rgba(0,0,0,0.15);
                z-index: 1001;
                flex-direction: column;
                align-items: stretch;
                padding: 20px 0 10px 0;
                animation: slideDown 0.25s;
            }
            .mobile-menu.open {
                display: flex;
            }
            .mobile-menu .header-button {
                width: 90%;
                margin: 0 auto 10px auto;
                font-size: 17px;
                padding: 12px 0;
                background: #fff;
                color: #8ac0ff;
                border: none;
                border-radius: 6px;
                font-weight: bold;
                box-shadow: 0 2px 6px rgba(0,0,0,0.07);
                transition: all 0.2s;
            }
            .mobile-menu .header-button.active {
                background: #ffdd00;
                color: #333;
            }
            .mobile-menu .header-button:active {
                background: #e6e6e6;
            }
            .mobile-menu-bg {
                display: none;
                position: fixed;
                top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.25);
                z-index: 1000;
            }
            .mobile-menu-bg.open {
                display: block;
            }
            @keyframes slideDown {
                from { transform: translateY(-40px); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
            #closeMovieButton {
                left: 8px;
                right: auto;
                top: 8px;
                font-size: 28px;
            }
            /* Bot√≥n cerrar men√∫ hamburguesa */
            .mobile-menu .close-mobile-menu {
                display: block;
                position: absolute;
                top: 10px;
                right: 16px;
                background: none;
                border: none;
                color: #fff;
                font-size: 32px;
                font-weight: bold;
                z-index: 1003;
                cursor: pointer;
            }
        }
        .gallery-filters {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .gallery-filters select {
            padding: 0px 2px;
            border-radius: 6px;
            border: 2px solid #ffdd00;
            font-size: 11px;
            background: #fff;
            color: #333;
            box-sizing: border-box;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            outline: none;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }
        .gallery-filters select:focus {
            border: 2px solid #8ac0ff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .header-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .header-button {
            background-color: transparent;
            color: var(--color-header-text);
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .header-button:hover, .header-button:focus, .header-button.random-movie:hover, .header-button.info:hover, .view-toggle button:hover, .pagination-button:hover, #resetGalleryBtn:hover {
            background-color: #ffdd00 !important;
            color: #23272a !important;
            box-shadow: none !important;
            outline: none !important;
        }
        .header-button.info {
            margin-left: auto;
        }
        .goto-label {
            font-size: 14px;
            color: #888;
            margin-left: 8px;
            margin-right: 2px;
        }
        #gotoPageInput {
            width: 38px;
            padding: 4px 6px;
            border-radius: 5px;
            border: 1px solid #d0d0d0;
            text-align: center;
            font-size: 15px;
            margin: 0 2px;
            outline: none;
            transition: border 0.2s;
        }
        #gotoPageInput:focus {
            border: 1.5px solid #8ac0ff;
            background: #f8fbff;
        }
        /* Ajuste para asegurar visibilidad correcta de men√∫s */
        .hamburger, .mobile-menu, .mobile-menu-bg {
            display: none;
        }
        @media (max-width: 600px) {
            .header-buttons {
                display: none !important;
            }
            .hamburger {
                display: block !important;
            }
        }
        @media (min-width: 601px) {
            .mobile-menu, .mobile-menu-bg {
                display: none !important;
            }
            .header-buttons {
                display: flex !important;
            }
            .hamburger {
                display: none !important;
            }
        }
        @media (max-width: 600px) {
            /* ... ajustes previos ... */
            #moviePopup {
                max-width: 98vw;
                width: 98vw;
                left: 50%;
                top: 0;
                transform: translate(-50%, 0);
                border-radius: 0 0 18px 18px;
                padding: 0;
                min-height: 60vh;
            }
            .movie-popup-content {
                flex-direction: column;
                padding: 0;
                max-height: 95vh;
                overflow-y: auto;
            }
            .movie-popup-poster {
                width: 100%;
                min-height: 220px;
                max-height: 45vw;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 0 0 12px 12px;
                overflow: hidden;
            }
            .movie-popup-poster-img {
                width: 100%;
                height: 100%;
                background-size: contain !important;
                background-position: center !important;
                background-repeat: no-repeat;
                border-radius: 0 0 12px 12px;
            }
            .movie-popup-info {
                padding: 18px 10px 10px 10px;
                font-size: 15px;
            }
            .movie-popup-title {
                font-size: 20px;
                margin-bottom: 8px;
                text-align: center;
            }
            .movie-popup-meta {
                font-size: 13px;
                margin-bottom: 10px;
                text-align: center;
            }
            .movie-popup-synopsis {
                margin-bottom: 12px;
            }
            .movie-popup-actions {
                flex-direction: column;
                gap: 8px;
                margin-top: 10px;
            }
            .movie-popup-actions a {
                font-size: 15px;
                padding: 10px 0;
            }
            #closeMovieButton {
                top: 8px;
                right: 8px;
                font-size: 28px;
            }
        }
        /* Tarjetas de lista para m√≥vil */
        @media (max-width: 600px) {
          #tableView table { display: none !important; }
          #tableView .mobile-list-cards { display: block !important; }
        }
        @media (min-width: 601px) {
          #tableView .mobile-list-cards { display: none !important; }
        }
        .mobile-list-cards {
          display: none;
          margin-top: 12px;
        }
        .mobile-list-card {
          background: #fff;
          border-radius: 10px;
          box-shadow: 0 1px 4px rgba(0,0,0,0.07);
          margin-bottom: 10px;
          padding: 10px 10px 10px 12px;
          font-size: 15px;
          display: flex;
          flex-direction: row;
          align-items: center;
          gap: 10px;
        }
        .mobile-list-card .ml-main {
          flex: 1;
          display: flex;
          flex-direction: column;
          gap: 2px;
        }
        .mobile-list-card .ml-title {
          font-weight: bold;
          font-size: 16px;
          color: var(--color-text);
          margin-bottom: 2px;
        }
        .mobile-list-card .ml-meta {
          color: #666;
          font-size: 13px;
        }
        .mobile-list-card .ml-actions {
          display: flex;
          flex-direction: column;
          gap: 6px;
          margin-left: 8px;
        }
        .mobile-list-card .ml-actions a {
          background: #8ac0ff;
          color: #fff;
          text-align: center;
          padding: 7px 0;
          border-radius: 5px;
          font-weight: bold;
          text-decoration: none;
          font-size: 14px;
          transition: background 0.2s;
          min-width: 80px;
        }
        .mobile-list-card .ml-actions a:hover { background: #ffdd00; color: #333; }
        @media (max-width: 600px) {
          .movie-popup-actions {
            flex-direction: column !important;
            align-items: center !important;
            text-align: center !important;
          }
          .movie-popup-actions a {
            text-align: center !important;
            width: 100% !important;
            margin: 0 auto 8px auto !important;
            display: block !important;
          }
          header h1 {
            text-align: center !important;
            left: 0 !important;
            right: 0 !important;
            margin: 0 auto !important;
            width: 100% !important;
            position: static !important;
            font-size: 22px !important;
            padding: 0 !important;
          }
        }
        /* Modo oscuro */
        body.dark-mode {
            --color-bg: #181a1b;
            --color-text: #e0e0e0;
            --color-header: #23272a;
            --color-header-text: #e0e0e0;
            --color-card-bg: #23272a;
            --color-card-shadow: rgba(0,0,0,0.5);
            --color-table-th: #23272a;
            --color-table-th-text: #e0e0e0;
            --color-table-td-bg: #23272a;
            --color-table-td-hover: #23272a;
            --color-btn: #444b52;
            --color-btn-hover: #586069;
            --color-btn-active: #ffdd00;
            --color-btn-active-text: #23272a;
            --color-tag-bg: #33373a;
            --color-tag-text: #b0b0b0;
            --color-popup-bg: #23272a;
            --color-popup-text: #e0e0e0;
            --color-popup-shadow: rgba(0,0,0,0.7);
        }
        .main-header {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            padding: 0 20px;
            min-height: 60px;
            position: relative;
        }
        .header-left {
            display: flex;
            align-items: center;
            justify-content: flex-start;
        }
        .header-center {
            display: flex;
            justify-content: center;
            align-items: center;
            min-width: 0;
        }
        .header-center h1 {
            margin: 0;
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.3s;
            text-align: center;
            width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .header-right {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 8px;
        }
        .header-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        @media (max-width: 600px) {
            .main-header {
                grid-template-columns: auto 1fr auto;
                padding: 10px 10px;
                min-height: unset;
            }
            .header-center h1 {
                font-size: 19px;
            }
        }
        /* Filtros e input alineados */
        .search-bar {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }
        .gallery-filters {
            margin: 0;
            display: flex;
            align-items: center;
        }
        .gallery-filters select {
            height: 48px;
            padding: 12px 16px;
            border-radius: 6px;
            border: 2px solid #ffdd00;
            font-size: 16px;
            background: #fff;
            color: #333;
            box-sizing: border-box;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            outline: none;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }
        .gallery-filters select:focus {
            border: 2px solid #8ac0ff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        /* Ocultar bot√≥n modo oscuro del header en m√≥vil */
        @media (max-width: 600px) {
            #darkModeBtn {
                display: none !important;
            }
        }
        body.dark-mode .mobile-menu {
            background: #23272a !important;
        }
        body.dark-mode .mobile-menu .header-button {
            color: #23272a !important;
        }
        body.dark-mode .mobile-menu .header-button.active {
            color: #fff !important;
        }
        body.dark-mode table th,
        body.dark-mode table td {
            border-bottom: 1px solid #8ac0ff !important;
        }
        /* Forzar l√≠neas celestes en la tabla en todos los modos */
        table th, table td,
        body.dark-mode table th, body.dark-mode table td {
            border-bottom: 1px solid #8ac0ff !important;
        }
        body.dark-mode .movie-popup-duration {
            color: #fff !important;
        }
        body:not(.dark-mode) .movie-popup-duration {
            color: #333 !important;
        }
        body.dark-mode .movie-popup-meta span, body.dark-mode .movie-popup-meta, body.dark-mode .movie-popup-duration {
            color: #fff !important;
        }
        .movie-popup-duration a {
            font-weight: 400 !important;
            text-decoration: none;
            cursor: default;
        }
        body.dark-mode .movie-popup-duration a {
            color: #fff !important;
        }
        body:not(.dark-mode) .movie-popup-duration a {
            color: #333 !important;
        }
        /* Duraci√≥n popup: m√°xima especificidad */
        .movie-popup-duration, .movie-popup-duration *, .movie-popup-meta span, .movie-popup-meta span * {
            color: #fff !important;
        }
        body.dark-mode .movie-popup-duration, body.dark-mode .movie-popup-duration *,
        body.dark-mode .movie-popup-meta span, body.dark-mode .movie-popup-meta span * {
            color: #333 !important;
        }

        /* Flechas de paginaci√≥n */
        .pagination-button {
            color: #333 !important;
        }
        body.dark-mode .pagination-button {
            color: #fff !important;
        }
        body.dark-mode a.popup-link-year,
        body.dark-mode a.popup-link-director,
        body.dark-mode .movie-popup-duration a {
            color: #fff !important;
        }
        body:not(.dark-mode) a.popup-link-year,
        body:not(.dark-mode) a.popup-link-director,
        body:not(.dark-mode) .movie-popup-duration a {
            color: #23272a !important;
        }
        @media (max-width: 600px) {
            .gallery-filters select {
                width: 100%;
                box-sizing: border-box;
            }
        }
        @media (max-width: 600px) {
            .search-bar input,
            .gallery-filters select {
                width: 100% !important;
                box-sizing: border-box;
                border: 2px solid #ffdd00;
                border-radius: 6px;
                padding: 12px;
                font-size: 16px;
                margin: 0;
                display: block;
            }
        }
        @media (max-width: 600px) {
            #galleryOrderSelect option[value="az-title"] { display: block; }
            #galleryOrderSelect option:not([value="az-title"]) { display: block; }
        }
        #galleryOrderSelectDesktop { display: block; }
        #galleryOrderSelectMobile { display: none; }
        @media (max-width: 600px) {
            #galleryOrderSelectDesktop { display: none !important; }
            #galleryOrderSelectMobile { display: block !important; width: 100% !important; }
        }
        @media (max-width: 600px) {
            body.dark-mode .movie-title,
            body.dark-mode .ml-title {
                color: #23272a !important;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
    <div class="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <header class="main-header">
        <div class="header-left">
            <button id="darkModeBtn" class="header-button" onclick="toggleDarkMode()">Oscuro üåô</button>
        </div>
        <div class="header-center">
            <h1 onclick="resetTable()">INFO REAL DE CINE</h1>
        </div>
        <div class="header-right">
            <button class="hamburger" id="hamburgerBtn" style="display:none; margin-left: 10px;" aria-label="Abrir men√∫">‚ò∞</button>
            <div class="header-buttons">
                <button id="galleryViewBtn" class="header-button" onclick="switchView('gallery')">üé¨ Galer√≠a</button>
                <button id="tableViewBtn" class="header-button" onclick="switchView('table')">üìã Lista</button>
                <button class="header-button random-movie" onclick="openRandomMovie()">Suerte</button>
                <button class="header-button info" onclick="showInfo()">Info</button>
            </div>
        </div>
    </header>
    <div class="mobile-menu-bg" id="mobileMenuBg"></div>
    <div class="mobile-menu" id="mobileMenu">
        <button class="close-mobile-menu" onclick="closeMobileMenu()" aria-label="Cerrar men√∫">√ó</button>
        <button id="galleryViewBtnMobile" class="header-button" onclick="switchView('gallery');closeMobileMenu();">üé¨ Galer√≠a</button>
        <button id="tableViewBtnMobile" class="header-button" onclick="switchView('table');closeMobileMenu();">üìã Lista</button>
        <button class="header-button random-movie" onclick="openRandomMovie();closeMobileMenu();">üçÄ Suerte</button>
        <button class="header-button info" onclick="showInfo();closeMobileMenu();">‚ÑπÔ∏è Info</button>
        <button id="darkModeBtnMobile" class="header-button" onclick="toggleDarkMode();closeMobileMenu();">Oscuro üåô</button>
    </div>

    <div class="container">
        <div class="search-bar" style="gap: 12px;">
            <input type="text" id="searchInput" placeholder="Buscar pel√≠cula / director / a√±o / etiqueta..." onkeyup="searchMovies()">
            <div id="galleryFilters" class="gallery-filters" style="margin: 0;">
                <select id="galleryOrderSelectDesktop" onchange="applyGalleryOrder()">
                    <option value="az-title">Orden alfab√©tico por pel√≠cula (A-Z)</option>
                    <option value="az-director">Orden alfab√©tico por director (A-Z)</option>
                    <option value="year-asc">A√±o (ascendente)</option>
                    <option value="year-desc">A√±o (descendente)</option>
                    <option value="duration-asc">Duraci√≥n (ascendente)</option>
                    <option value="duration-desc">Duraci√≥n (descendente)</option>
                </select>
                <select id="galleryOrderSelectMobile" onchange="applyGalleryOrder()">
                    <option value="az-title">üîΩ</option>
                    <option value="az-director">Dir</option>
                    <option value="year-asc">A‚Üë</option>
                    <option value="year-desc">A‚Üì</option>
                    <option value="duration-asc">D‚Üë</option>
                    <option value="duration-desc">D‚Üì</option>
                </select>
            </div>
            <button class="reset-button" id="resetButton" onclick="resetTable()">Volver</button>
        </div>

        <!-- Bot√≥n 'Ver todas las pel√≠culas' eliminado, solo queda 'Volver' -->

        <div id="tableView" class="table-view">
            <table id="movieTable">
                <thead>
                    <tr>
                        <th class="sortable" onclick="handleColumnClick('title')">Pel√≠cula</th>
                        <th class="sortable" onclick="handleColumnClick('year')">A√±o</th>
                        <th class="sortable" onclick="handleColumnClick('duration')">Duraci√≥n</th>
                        <th class="sortable" onclick="handleColumnClick('director')">Director</th>
                        <th>Etiquetas</th>
                        <th>Ver</th>
                        <th>Letterboxd</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>

        <div id="galleryView" class="gallery-view">
            <div id="galleryGrid" class="gallery-grid">
            </div>
            <div id="galleryPagination" class="gallery-pagination" style="display: none;">
                <button class="pagination-button" id="prevPageBtn" onclick="changePage(-1)">‚ùÆ</button>
                <span class="pagination-info" id="pageInfo">P√°gina 1 de 1</span>
                <button class="pagination-button" id="nextPageBtn" onclick="changePage(1)">‚ùØ</button>
                <span class="goto-label" id="gotoLabel" style="display:none; margin-left:12px;">Ir a:</span>
                <input id="gotoPageInput" type="number" min="1" value="1" style="display:none;" onchange="gotoGalleryPage()" onkeydown="if(event.key==='Enter'){gotoGalleryPage();}" onfocus="this.select()">
            </div>
        </div>
    </div>

    <div id="infoPopup" onclick="closeInfo()">
        <button id="closeInfoButton" onclick="closeInfo()">√ó</button>
        <div class="popup-content" onclick="event.stopPropagation()">
            <p>Info Real de Cine es una base de datos de cine argentino creada por David Fern√°ndez aka <a href="https://x.com/inforealDcine" target="_blank"><strong>ELDEIBIK</strong></a>, que recopila enlaces proporcionados por terceros.</p>
            <p>Esta es una web que ayuda a su visualizaci√≥n. Est√° siendo construida por <a href="https://www.lennyforster.com" target="_blank">Lenny Forster</a>.</p>
            <p>En caso de querer quitar una pel√≠cula del cat√°logo, no dudes en comunicarte a trav√©s de <a href="https://x.com/inforealDcine" target="_blank">@inforealdcine</a>.</p>
        </div>
    </div>

    <!-- Popup de pel√≠cula con sinopsis -->
    <div id="moviePopup" onclick="closeMoviePopup()">
        <button id="closeMovieButton" onclick="closeMoviePopup()">√ó</button>
        <div class="movie-popup-content" onclick="event.stopPropagation()">
            <div class="movie-popup-poster">
                <div class="movie-popup-poster-img"></div>
            </div>
            <div class="movie-popup-info">
                <h2 class="movie-popup-title"></h2>
                <div class="movie-popup-meta">
                    <span class="movie-popup-year"></span>
                    <span class="movie-popup-duration"></span>
                    <span class="movie-popup-director"></span>
                </div>
                <div class="movie-popup-synopsis">
                    <h3>Sinopsis</h3>
                    <p class="synopsis-text">Cargando sinopsis...</p>
                </div>
                <div class="movie-popup-actions">
                    <a href="#" class="movie-popup-watch" target="_blank">Ver Pel√≠cula</a>
                    <a href="#" class="movie-popup-letterboxd" target="_blank">Ver en Letterboxd</a>
                </div>
            </div>
        </div>
    </div>

    <button id="scrollToTop" class="scroll-to-top">‚Üë</button>

    <!-- ClustrMaps oculto -->
    <div id="clustrmaps-container" style="display:none;">
        <script type="text/javascript" id="clustrmaps" src="//clustrmaps.com/map_v2.js?d=p7hIlaaLoOXct1kas3WenOZiD_ZbKFxo_z0626kfKKg&cl=ffffff&w=a"></script>
    </div>

    <script>
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });

        let movieData = [];
        // Variable global para el filtro actual
        let currentFilter = {
            type: null, // 'search', 'director', 'year', 'tag', null
            value: null
        };
        let currentSort = {
            column: null,
            ascending: true,
            clicks: 0
        };
        let currentView = 'gallery';
        let currentPage = 1;
        let moviesPerPage = 12;
        let filteredMovies = [];
        let posterStats = {
            total: 0,
            loaded: 0,
            failed: 0,
            pending: 0
        };

        document.querySelector('.loading-overlay').classList.add('visible');

        window.onload = function() {
            const googleSheetCSVUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQdSMv1aOknkND4N9vUzO3cNbWMBFi62U7Gx5SsH-ytlEsF91CbD7hfMZmXjNwY9Rd1PZjdslDTY6Uv/pub?output=csv';
            
            fetch(googleSheetCSVUrl)
                .then(response => response.text())
                .then(csvData => {
                    Papa.parse(csvData, {
                        complete: function(results) {
                            movieData = results.data.map(row => ({
                                title: row[0],
                                director: row[1],
                                year: parseInt(row[2]),
                                duration: row[3] ? row[3].trim() : null,
                                movieLink: row[4],
                                letterboxdLink: row[5],
                                tags: row[6] ? row[6].split(',').map(tag => tag.trim()) : [],
                                posterLink: row[7] ? row[7].trim() : '', // NUEVO: columna H
                                isNew: isNewMovie(row[0])
                            }));
                            shuffleArray(movieData);
                            renderTable(movieData);
                            renderGallery(movieData);
                            // Mostrar galer√≠a como principal
                            switchView('gallery');
                            setTimeout(() => {
                                document.querySelector('.loading-overlay').classList.remove('visible');
                            }, 500);
                        },
                        header: false,
                        skipEmptyLines: true
                    });
                })
                .catch(error => {
                    console.error("Error al cargar el archivo CSV:", error);
                    document.querySelector('.loading-overlay').classList.remove('visible');
                });
        };

        function switchView(view) {
            currentView = view;
            // Actualizar botones
            document.getElementById('tableViewBtn').classList.toggle('active', view === 'table');
            document.getElementById('galleryViewBtn').classList.toggle('active', view === 'gallery');
            // Mostrar/ocultar vistas
            document.getElementById('tableView').style.display = view === 'table' ? 'block' : 'none';
            document.getElementById('galleryView').style.display = view === 'gallery' ? 'block' : 'none';
            // Aplicar el filtro actual al cambiar de vista
            applyCurrentFilter();
        }

        function applyCurrentFilter() {
            let filtered = movieData;
            if (currentFilter.type === 'search') {
                const query = currentFilter.value;
                filtered = movieData.filter(movie =>
                    movie.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").includes(query) ||
                    movie.director.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").includes(query) ||
                    movie.year.toString().includes(query) ||
                    movie.tags.some(tag => tag.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").includes(query))
                );
            } else if (currentFilter.type === 'director') {
                const searchDirector = currentFilter.value.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                filtered = movieData.filter(movie => {
                    const movieDirectors = movie.director
                        .split(/\s+[y&,]\s+|\s*,\s*/g)
                        .map(d => d.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, ""))
                        .filter(d => d !== '');
                    return movieDirectors.includes(searchDirector);
                });
            } else if (currentFilter.type === 'year') {
                filtered = movieData.filter(m => m.year === currentFilter.value);
            } else if (currentFilter.type === 'tag') {
                filtered = movieData.filter(movie => movie.tags.includes(currentFilter.value));
            }
            renderTable(filtered);
            renderGallery(filtered);
        }

        function renderGallery(movies) {
            filteredMovies = movies;
            currentPage = 1;
            updateGallery();
            // Mostrar bot√≥n 'Volver' si la galer√≠a est√° filtrada
            const resetButton = document.getElementById('resetButton');
            if (movies.length !== movieData.length) {
                resetButton.style.display = 'inline';
            } else {
                resetButton.style.display = 'none';
            }
        }

        function updateGallery() {
            const galleryGrid = document.getElementById('galleryGrid');
            const paginationDiv = document.getElementById('galleryPagination');
            
            if (filteredMovies.length === 0) {
                galleryGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #666;">
                        <div style="font-size: 16px;">
                            No encontramos lo que estabas buscando üòï
                            <br>
                            <button onclick="resetTable()" style="margin-top: 15px; padding: 8px 15px; background: #8ac0ff; border: none; color: white; border-radius: 4px; cursor: pointer;">
                                Ver todas las pel√≠culas
                            </button>
                        </div>
                    </div>
                `;
                paginationDiv.style.display = 'none';
                return;
            }

            const totalPages = Math.ceil(filteredMovies.length / moviesPerPage);
            const startIndex = (currentPage - 1) * moviesPerPage;
            const endIndex = startIndex + moviesPerPage;
            const currentMovies = filteredMovies.slice(startIndex, endIndex);

            // Inicializar estad√≠sticas para esta p√°gina
            posterStats.total = currentMovies.length;
            posterStats.loaded = 0;
            posterStats.failed = 0;
            posterStats.pending = currentMovies.length;

            // Mostrar loading mientras se cargan los posters
            galleryGrid.innerHTML = `
                <div class="gallery-loading" style="grid-column: 1 / -1;">
                    <div class="loading-spinner"></div>
                    <div>Cargando posters... (0/${currentMovies.length})</div>
                </div>
            `;

            // Renderizar las pel√≠culas de la p√°gina actual
            setTimeout(() => {
                galleryGrid.innerHTML = '';
                
                currentMovies.forEach((movie, index) => {
                    const card = document.createElement('div');
                    card.className = 'movie-card';
                    
                    const newBadge = movie.isNew ? '<div class="new-badge">NUEVO</div>' : '';
                    
                    card.innerHTML = `
                        ${newBadge}
                        <div class="movie-poster" data-letterboxd="${movie.letterboxdLink}"></div>
                        <div class="movie-info">
                            <div class="movie-title">${movie.title}</div>
                            <div class="movie-meta">
                                <span class="movie-year">${movie.year}</span>
                                ${movie.duration ? ` ‚Ä¢ ${movie.duration}'` : ''}
                            </div>
                            <div class="movie-director">${movie.director}</div>
                            <div class="movie-tags">
                                ${movie.tags.slice(0, 3).map(tag => `<span class="movie-tag">${tag}</span>`).join('')}
                                ${movie.tags.length > 3 ? `<span class="movie-tag">+${movie.tags.length - 3}</span>` : ''}
                            </div>
                            <div class="movie-actions">
                                <a href="${movie.movieLink}" target="_blank">Ver</a>
                                <a href="${movie.letterboxdLink}" target="_blank">Letterboxd</a>
                            </div>
                        </div>
                    `;
                    
                    // Agregar evento click para abrir popup
                    card.addEventListener('click', (e) => {
                        // Evitar que se abra si se hace click en los enlaces
                        if (e.target.tagName === 'A') return;
                        showMoviePopup(movie, card);
                    });
                    
                    galleryGrid.appendChild(card);
                    
                    // NUEVO: cargar poster desde Google Drive si hay link
                    (function() {
                        const posterDiv = card.querySelector('.movie-poster');
                        if (movie.posterLink) {
                            let cleanLink = movie.posterLink.trim().replace(/^"|"$/g, '').replace(/\s+/g, '');
                            console.log('Intentando cargar poster desde Google Drive:', movie.title, movie.year, cleanLink);
                            const img = new Image();
                            img.onload = function() {
                                posterDiv.style.backgroundImage = `url('${cleanLink}')`;
                                posterDiv.classList.add('loaded');
                            };
                            img.onerror = function(e) {
                                console.warn('‚ùå Fall√≥ la carga del poster de Drive para:', movie.title, movie.year, cleanLink, e);
                                const proxyUrl = `https://images.weserv.nl/?url=${encodeURIComponent(cleanLink)}&w=300&h=450&fit=cover&output=jpg&q=85`;
                                const proxyImg = new Image();
                                proxyImg.onload = function() {
                                    posterDiv.style.backgroundImage = `url('${proxyUrl}')`;
                                    posterDiv.classList.add('loaded');
                                };
                                proxyImg.onerror = function(e2) {
                                    setMoviePlaceholder(posterDiv, movie.title, movie.year, 'drive-failed');
                                    loadPosterFromLetterboxd(movie.letterboxdLink, posterDiv);
                                };
                                proxyImg.src = proxyUrl;
                            };
                            img.src = cleanLink;
                        } else {
                            loadPosterFromLetterboxd(movie.letterboxdLink, posterDiv);
                        }
                    })();
                });

                // Actualizar paginaci√≥n
                updatePagination(totalPages);
                
                // Mostrar estad√≠sticas iniciales
                showPosterStats();
            }, 300);
        }

        function updatePagination(totalPages) {
            const paginationDiv = document.getElementById('galleryPagination');
            const pageInfo = document.getElementById('pageInfo');
            const prevBtn = document.getElementById('prevPageBtn');
            const nextBtn = document.getElementById('nextPageBtn');
            const gotoInput = document.getElementById('gotoPageInput');
            const gotoLabel = document.getElementById('gotoLabel');

            if (totalPages <= 1) {
                paginationDiv.style.display = 'none';
                gotoInput.style.display = 'none';
                gotoLabel.style.display = 'none';
                return;
            }

            paginationDiv.style.display = 'flex';
            pageInfo.textContent = `P√°gina ${currentPage} de ${totalPages}`;
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;
            gotoInput.value = currentPage;
            gotoInput.style.display = 'inline-block';
            gotoLabel.style.display = 'inline-block';
            gotoInput.max = totalPages;
        }

        function changePage(direction) {
            const totalPages = Math.ceil(filteredMovies.length / moviesPerPage);
            const newPage = currentPage + direction;
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                updateGallery();
                
                // Scroll suave hacia arriba de la galer√≠a
                document.getElementById('galleryView').scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        }

        function gotoGalleryPage() {
            const input = document.getElementById('gotoPageInput');
            const totalPages = Math.ceil(filteredMovies.length / moviesPerPage);
            let page = parseInt(input.value);
            if (isNaN(page) || page < 1) page = 1;
            if (page > totalPages) page = totalPages;
            currentPage = page;
            updateGallery();
        }

        function loadPosterFromLetterboxd(letterboxdUrl, posterElement) {
            console.log('=== INICIO DE CARGA DE POSTER ===');
            console.log('URL de Letterboxd:', letterboxdUrl);
            
            // Extraer el slug de la URL de Letterboxd
            const match = letterboxdUrl.match(/letterboxd\.com\/film\/([^\/]+)/);
            if (!match) {
                console.log('‚ùå No se pudo extraer slug de:', letterboxdUrl);
                setPlaceholderPoster(posterElement, null, null, 'No se pudo extraer slug');
                return;
            }

            const slug = match[1];
            console.log('‚úÖ Slug extra√≠do:', slug);
            
            // Obtener informaci√≥n de la pel√≠cula para fallback
            const movieCard = posterElement.closest('.movie-card');
            const movieTitle = movieCard.querySelector('.movie-title').textContent;
            const movieYear = movieCard.querySelector('.movie-year').textContent;
            
            console.log('üìΩÔ∏è Pel√≠cula:', movieTitle, '(', movieYear, ')');
            
            // Agregar delay aleatorio para evitar saturar los proxies
            const delay = Math.random() * 2000; // 0-2 segundos
            setTimeout(() => {
                // M√©todo 1: Extraer la URL real del poster desde la p√°gina de Letterboxd
                fetchLetterboxdPosterUrl(letterboxdUrl, posterElement, movieTitle, movieYear);
            }, delay);
        }

        function fetchLetterboxdPosterUrl(letterboxdUrl, posterElement, movieTitle, movieYear) {
            console.log('üîç Extrayendo URL del poster y sinopsis desde:', letterboxdUrl);
            
            // Lista de proxies alternativos
            const proxies = [
                `https://api.allorigins.win/raw?url=${encodeURIComponent(letterboxdUrl)}`,
                `https://cors-anywhere.herokuapp.com/${letterboxdUrl}`,
                `https://thingproxy.freeboard.io/fetch/${letterboxdUrl}`,
                `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(letterboxdUrl)}`
            ];
            
            let currentProxyIndex = 0;
            
            function tryNextProxy() {
                if (currentProxyIndex >= proxies.length) {
                    console.log('‚ùå Todos los proxies fallaron');
                    setMoviePlaceholder(posterElement, movieTitle, movieYear, 'proxy-failed');
                    return;
                }
                
                const proxyUrl = proxies[currentProxyIndex];
                console.log(`üîÑ Intentando proxy ${currentProxyIndex + 1}/${proxies.length}:`, proxyUrl);
                
                fetch(proxyUrl)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.text();
                    })
                    .then(html => {
                        console.log('‚úÖ P√°gina de Letterboxd obtenida, buscando <img> del poster y sinopsis...');
                        
                        // M√©todo inteligente para identificar la sinopsis
                        let synopsis = '';
                        let method = '';
                        // 1. Buscar todos los bloques de texto grandes
                        let candidates = [];
                        // Extraer todos los <p>, <div>, <section> con m√°s de 100 y menos de 600 caracteres
                        const blockRegex = /<(p|div|section)[^>]*>([\s\S]*?)<\/\1>/gi;
                        let match;
                        while ((match = blockRegex.exec(html)) !== null) {
                            let text = match[2].replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim();
                            if (text.length >= 100 && text.length <= 600) {
                                candidates.push(text);
                            }
                        }
                        // 2. Descartar los que contengan palabras de reviews, ratings, usuarios, fechas, etc.
                        const forbiddenWords = [
                            'review', 'user', 'rating', 'diary', 'log', 'spoiler', 'comment', 'stars', 'watched', 'likes', 'followers', 'minutes ago', 'hours ago', 'days ago', 'weeks ago', 'months ago', 'years ago', 'ago', 'joined', 'lists', 'followers', 'following', 'replies', 'reply', 'edit', 'delete', 'report', 'flag', 'spoilers', 'add to', 'share', 'tweet', 'facebook', 'twitter', 'instagram', 'letterboxd', 'tmdb', 'imdb', '¬©', 'cookie', 'login', 'sign up', 'sign in', 'register', 'account', 'password', 'email', 'terms', 'privacy', 'policy', 'help', 'support', 'api', 'pro', 'upgrade', 'ads', 'mobile site', 'powered by', 'nanocrowd', 'contact', 'app', 'apps', 'news', 'podcast', 'year in review', 'gifts', 'about', 'story by', 'translated', 'translate', 'liked', 'show all', 'mentioned by', 'add all films', 'start a new list', 'add to your films', 'watchlist', 'diary entry', 'spoilers', 'rating', 'privacy mode', 'default', 'anyone', 'close friends', 'draft', 'entries', 'lists', 'public', 'private', 'reactions', 'visible', 'members', 'friends', 'link', 'search', 'where to watch', 'trailer', 'justwatch', 'cast', 'crew', 'details', 'genres', 'releases', 'premiere', 'theatrical', 'physical', 'digital', 'tv', 'story', 'mentioned by', 'powered by', 'nanocrowd', 'upgrade', 'remove ads', 'learn more about pro', 'site is protected', 'recaptcha', 'google privacy policy', 'terms of service apply', 'select your preferred poster', 'reset poster', 'save changes', 'this item only', 'select your preferred backdrop', 'upgrade to remove ads', 'independent service', 'created by a small team', 'support of our members', 'cool additional features', 'favorite streaming services', 'no ads', 'learn more about pro', 'film data from tmdb', 'mobile site', 'this site is protected', 'google privacy policy', 'terms of service apply', 'all', 'similar films', 'popular reviews', 'more', 'review by', 'liked', 'translate', 'translated from', 'by', 'show all', 'story by', 'powered by nanocrowd', 'mentioned by', 'about', 'pro', 'news', 'apps', 'podcast', 'year in review', 'gifts', 'help', 'terms', 'api', 'contact', 'instagram', 'threads', 'x', 'bluesky', 'facebook', 'tiktok', 'youtube', '¬© letterboxd limited', 'made by fans', 'aotearoa new zealand', 'film data from tmdb', 'mobile site', 'this site is protected', 'recaptcha', 'google privacy policy', 'terms of service apply'
                        ];
                        candidates = candidates.filter(text => {
                            let t = text.toLowerCase();
                            return !forbiddenWords.some(word => t.includes(word));
                        });
                        // 3. Priorizar los que aparecen antes de 'Cast', 'Crew', 'Genres', 'Reviews'
                        let cutIndex = html.search(/Cast|Crew|Genres|Reviews/i);
                        if (cutIndex > 0) {
                            candidates = candidates.filter(text => {
                                let idx = html.indexOf(text);
                                return idx > 0 && idx < cutIndex;
                            });
                        }
                        // 4. Si hay varios candidatos, elegir el m√°s largo o el que m√°s palabras clave de sinopsis tenga
                        const synopsisWords = ['historia', 'vida', 'aventura', 'familia', 'descubre', 'viaje', 'misterio', 'amor', 'drama', 'pel√≠cula', 'cine', 'director', 'protagonista', 'relato', 'mundo', 'realidad', 'sue√±o', 'pasado', 'presente', 'futuro', 'secreto', 'memoria', 'recuerdo', 'destino', 'conflicto', 'sociedad', 'cambio', 'transformaci√≥n', 'b√∫squeda', 'identidad', 'relaci√≥n', 'amistad', 'enemigo', 'enemistad', 'poder', 'lucha', 'esperanza', 'desaf√≠o', 'superaci√≥n', 'crisis', 'familia', 'hermano', 'hermana', 'padre', 'madre', 'hijo', 'hija', 'ni√±o', 'ni√±a', 'adulto', 'anciano', 'joven', 'adolescente', 'infancia', 'madurez', 'vejez', 'muerte', 'nacimiento', 'renacimiento', 'amor', 'odio', 'paz', 'guerra', 'libertad', 'prisi√≥n', 'escape', 'huida', 'encuentro', 'despedida', 'regreso', 'partida', 'viaje', 'camino', 'ruta', 'destino', 'meta', 'objetivo', 'sue√±o', 'pesadilla', 'realidad', 'fantas√≠a', 'magia', 'misterio', 'secreto', 'verdad', 'mentira', 'enga√±o', 'traici√≥n', 'lealtad', 'amistad', 'enemistad', 'poder', 'lucha', 'conflicto', 'paz', 'guerra', 'esperanza', 'desesperanza', 'alegr√≠a', 'tristeza', 'felicidad', 'infelicidad', 'placer', 'dolor', 'placer', 'sufrimiento', 'placer', 'placer', 'placer'];
                        let best = '';
                        let bestScore = 0;
                        for (let text of candidates) {
                            let score = 0;
                            for (let w of synopsisWords) {
                                if (text.toLowerCase().includes(w)) score++;
                            }
                            if (score > bestScore || (score === bestScore && text.length > best.length)) {
                                best = text;
                                bestScore = score;
                            }
                        }
                        if (best) {
                            synopsis = best;
                            method = 'inteligente';
                        }
                        // 5. Si no hay ninguno, usar og:description
                        if (!synopsis) {
                            let ogMatch = html.match(/<meta[^>]*property=["']og:description["'][^>]*content=["']([^"']+)["'][^>]*>/i);
                            if (ogMatch && ogMatch[1]) {
                                synopsis = ogMatch[1].trim();
                                method = 'og:description';
                            }
                        }
                        if (!synopsis) {
                            synopsis = 'Sinopsis no disponible.';
                            method = 'ninguno';
                        }
                        // Limpiar la sinopsis
                        synopsis = synopsis.replace(/\s+/g, ' ').trim();
                        if (synopsis.length > 500) {
                            synopsis = synopsis.substring(0, 500) + '...';
                        }
                        console.log('M√©todo de sinopsis usado:', method, '| Sinopsis:', synopsis.substring(0, 100) + '...');
                        
                        // Guardar sinopsis en el elemento poster para uso posterior
                        posterElement.setAttribute('data-synopsis', synopsis);
                        
                        // 1. Buscar el <img> del poster
                        const imgMatch = html.match(/<img[^>]+src=["']([^"']*\/resized\/film-poster\/[^"']+)["'][^>]*>/i);
                        if (imgMatch && imgMatch[1]) {
                            let posterUrl = imgMatch[1];
                            // Si el src es relativo, hacerlo absoluto
                            if (posterUrl.startsWith('//')) {
                                posterUrl = 'https:' + posterUrl;
                            } else if (posterUrl.startsWith('/')) {
                                posterUrl = 'https://letterboxd.com' + posterUrl;
                            }
                            console.log('‚úÖ URL del poster encontrada por <img>:', posterUrl);
                            loadPosterImage(posterUrl, posterElement);
                            return;
                        }
                        // 2. Si no se encuentra, intentar con JSON-LD
                        console.log('‚ùå No se encontr√≥ <img> del poster, buscando JSON-LD...');
                        const scriptMatch = html.match(/<script[^>]*type="application\/ld\+json"[^>]*>([\s\S]*?)<\/script>/);
                        if (scriptMatch) {
                            const jsonText = scriptMatch[1];
                            try {
                                const cleanJson = jsonText.replace(/\/\*[\s\S]*?\*\//g, '').trim();
                                const jsonData = JSON.parse(cleanJson);
                                if (jsonData.image) {
                                    console.log('‚úÖ URL del poster encontrada por JSON-LD:', jsonData.image);
                                    loadPosterImage(jsonData.image, posterElement);
                                    return;
                                } else {
                                    console.log('‚ùå No se encontr√≥ imagen en JSON-LD');
                                }
                            } catch (error) {
                                console.log('‚ùå Error parseando JSON-LD:', error);
                            }
                        } else {
                            console.log('‚ùå No se encontr√≥ JSON-LD en la p√°gina');
                        }
                        // 3. Si ambos fallan, usar m√©todo alternativo de tama√±os
                        console.log('‚ùå No se pudo extraer el poster, usando m√©todo alternativo de tama√±os...');
                        tryAlternativeMethods(letterboxdUrl, posterElement, movieTitle, movieYear);
                    })
                    .catch(error => {
                        console.log(`‚ùå Error con proxy ${currentProxyIndex + 1}:`, error);
                        currentProxyIndex++;
                        setTimeout(() => {
                            tryNextProxy();
                        }, 1000);
                    });
            }
            tryNextProxy();
        }

        function tryAlternativeMethods(letterboxdUrl, posterElement, movieTitle, movieYear) {
            console.log('üîÑ Intentando m√©todos alternativos...');
            
            // Extraer el slug de la URL de Letterboxd
            const match = letterboxdUrl.match(/letterboxd\.com\/film\/([^\/]+)/);
            if (!match) {
                console.log('‚ùå No se pudo extraer slug para m√©todos alternativos');
                setMoviePlaceholder(posterElement, movieTitle, movieYear, 'desconocido');
                return;
            }

            const slug = match[1];
            console.log('üîß Slug para m√©todos alternativos:', slug);
            
            // M√©todo alternativo 1: Intentar con diferentes tama√±os de poster
            const posterSizes = [
                `${slug}-0-600-0-900-crop.jpg`,
                `${slug}-0-300-0-450-crop.jpg`,
                `${slug}-0-230-0-345-crop.jpg`,
                `${slug}-0-150-0-225-crop.jpg`,
                `${slug}-0-100-0-150-crop.jpg`
            ];
            
            tryNextPosterSize(posterSizes, 0, posterElement, movieTitle, movieYear);
        }

        function tryNextPosterSize(posterSizes, index, posterElement, movieTitle, movieYear) {
            if (index >= posterSizes.length) {
                console.log('‚ùå Todos los tama√±os de poster fallaron, intentando con diferentes proxies...');
                tryProxyMethods(posterSizes[0], posterElement, movieTitle, movieYear);
                return;
            }
            
            const posterSize = posterSizes[index];
            const posterUrl = `https://a.ltrbxd.com/resized/film-poster/${posterSize}`;
            
            console.log(`üîß Probando tama√±o ${index + 1}/${posterSizes.length}:`, posterUrl);
            
            const img = new Image();
            img.onload = function() {
                console.log('‚úÖ ¬°Poster cargado con tama√±o alternativo!');
                posterElement.style.backgroundImage = `url(${posterUrl})`;
                posterElement.classList.add('loaded');
                // updatePosterStats('loaded'); // Eliminado
            };
            img.onerror = function() {
                console.log(`‚ùå Tama√±o ${index + 1} fall√≥, probando siguiente...`);
                // Intentar con un peque√±o delay para evitar sobrecarga
                setTimeout(() => tryNextPosterSize(posterSizes, index + 1, posterElement, movieTitle, movieYear), 50);
            };
            img.src = posterUrl;
        }

        function tryProxyMethods(posterSize, posterElement, movieTitle, movieYear) {
            console.log('üåê Intentando con diferentes proxies...');
            
            const posterUrl = `https://a.ltrbxd.com/resized/film-poster/${posterSize}`;
            const proxies = [
                `https://images.weserv.nl/?url=${encodeURIComponent(posterUrl)}&w=300&h=450&fit=cover&output=jpg&q=85`,
                `https://cors-anywhere.herokuapp.com/${posterUrl}`,
                `https://api.allorigins.win/raw?url=${encodeURIComponent(posterUrl)}`,
                `https://thingproxy.freeboard.io/fetch/${posterUrl}`,
                `https://corsproxy.io/?${encodeURIComponent(posterUrl)}`
            ];
            
            tryNextProxy(proxies, 0, posterElement, movieTitle, movieYear);
        }

        function tryNextProxy(proxies, index, posterElement, movieTitle, movieYear) {
            if (index >= proxies.length) {
                console.log('‚ùå Todos los proxies fallaron, usando placeholder...');
                // Si no tenemos t√≠tulo y a√±o, obtenerlos del elemento
                if (!movieTitle || !movieYear) {
                    const movieCard = posterElement.closest('.movie-card');
                    if (movieCard) {
                        movieTitle = movieCard.querySelector('.movie-title').textContent;
                        movieYear = movieCard.querySelector('.movie-year').textContent;
                    }
                }
                setMoviePlaceholder(posterElement, movieTitle || 'Pel√≠cula', movieYear || '', 'proxy');
                // updatePosterStats('failed'); // Eliminado
                return;
            }
            
            const proxyUrl = proxies[index];
            console.log(`üåê Probando proxy ${index + 1}/${proxies.length}:`, proxyUrl);
            
            const img = new Image();
            img.onload = function() {
                console.log('‚úÖ ¬°Poster cargado con proxy!');
                posterElement.style.backgroundImage = `url(${proxyUrl})`;
                posterElement.classList.add('loaded');
                // updatePosterStats('loaded'); // Eliminado
            };
            img.onerror = function() {
                console.log(`‚ùå Proxy ${index + 1} fall√≥, probando siguiente...`);
                setTimeout(() => tryNextProxy(proxies, index + 1, posterElement, movieTitle, movieYear), 100);
            };
            img.src = proxyUrl;
        }

        function loadPosterImage(posterUrl, posterElement) {
            console.log('üñºÔ∏è Cargando imagen del poster:', posterUrl);
            
            const img = new Image();
            
            img.onload = function() {
                console.log('‚úÖ ¬°POSTER CARGADO EXITOSAMENTE!');
                posterElement.style.backgroundImage = `url(${posterUrl})`;
                posterElement.classList.add('loaded');
                // updatePosterStats('loaded'); // Eliminado
            };
            
            img.onerror = function() {
                console.log('‚ùå Error cargando imagen del poster:', posterUrl);
                // Intentar con m√∫ltiples proxies si falla
                const proxies = [
                    `https://images.weserv.nl/?url=${encodeURIComponent(posterUrl)}&w=300&h=450&fit=cover&output=jpg&q=85`,
                    `https://cors-anywhere.herokuapp.com/${posterUrl}`,
                    `https://api.allorigins.win/raw?url=${encodeURIComponent(posterUrl)}`,
                    `https://thingproxy.freeboard.io/fetch/${posterUrl}`,
                    `https://corsproxy.io/?${encodeURIComponent(posterUrl)}`
                ];
                
                tryNextProxy(proxies, 0, posterElement, null, null);
            };
            
            img.src = posterUrl;
        }



        function setMoviePlaceholder(element, title, year, reason) {
            console.log('üé® Usando placeholder personalizado para:', title, 'Motivo:', reason || 'desconocido');
            
            // Crear un placeholder m√°s atractivo con informaci√≥n de la pel√≠cula
            element.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            element.style.backgroundSize = 'cover';
            element.style.backgroundPosition = 'center';
            element.style.display = 'flex';
            element.style.alignItems = 'center';
            element.style.justifyContent = 'center';
            element.style.color = 'white';
            element.style.fontSize = '14px';
            element.style.fontWeight = 'bold';
            element.style.textAlign = 'center';
            element.style.padding = '20px';
            element.style.boxSizing = 'border-box';
            element.style.textShadow = '2px 2px 4px rgba(0,0,0,0.5)';
            
            // Agregar texto con informaci√≥n de la pel√≠cula (sin informaci√≥n t√©cnica)
            element.innerHTML = `
                <div>
                    <div style="font-size: 16px; margin-bottom: 8px;">${title}</div>
                    <div style="font-size: 12px; opacity: 0.9;">${year}</div>
                    <div style="font-size: 10px; opacity: 0.7; margin-top: 8px;">üé¨</div>
                </div>
            `;
            
            element.classList.add('loaded');
        }

        function setPlaceholderPoster(element) {
            element.style.backgroundImage = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            element.style.backgroundSize = 'cover';
            element.style.backgroundPosition = 'center';
            element.classList.add('loaded');
        }

        function isNewMovie(title) {
            const newMovies = new Set(['Pel√≠cula Nueva 1', 'Pel√≠cula Nueva 2']);
            return newMovies.has(title);
        }

        function handleColumnClick(column) {
            event.preventDefault();
            
            if (currentSort.column === column) {
                currentSort.clicks++;
                if (currentSort.clicks === 3) {
                    currentSort.clicks = 0;
                    currentSort.column = null;
                    renderTable(movieData);
                    if (currentView === 'gallery') {
                        renderGallery(movieData);
                    }
                    return;
                }
                currentSort.ascending = !currentSort.ascending;
            } else {
                currentSort.column = column;
                currentSort.ascending = true;
                currentSort.clicks = 1;
            }

            let sortedMovies = [...movieData];
            
            switch (column) {
                case 'title':
                    sortedMovies.sort((a, b) => {
                        return currentSort.ascending ? 
                            a.title.localeCompare(b.title) : 
                            b.title.localeCompare(a.title);
                    });
                    break;
                case 'director':
                    sortedMovies.sort((a, b) => {
                        return currentSort.ascending ? 
                            a.director.localeCompare(b.director) : 
                            b.director.localeCompare(a.director);
                    });
                    break;
                case 'year':
                    sortedMovies.sort((a, b) => {
                        return currentSort.ascending ? a.year - b.year : b.year - a.year;
                    });
                    break;
                case 'duration':
                    sortedMovies.sort((a, b) => {
                        const durationA = a.duration ? parseInt(a.duration) : 0;
                        const durationB = b.duration ? parseInt(b.duration) : 0;
                        return currentSort.ascending ? durationA - durationB : durationB - durationA;
                    });
                    break;
            }

            updateSortArrows(column);
            renderTable(sortedMovies);
            if (currentView === 'gallery') {
                renderGallery(sortedMovies);
            }
        }

        function updateSortArrows(column) {
            const headers = document.querySelectorAll('th.sortable');
            headers.forEach(header => {
                header.classList.remove('sort-asc', 'sort-desc');
                const headerText = header.textContent.toLowerCase();
                if (headerText.includes(column) || 
                    (column === 'title' && headerText.includes('pel√≠cula'))) {
                    header.classList.add(currentSort.ascending ? 'sort-asc' : 'sort-desc');
                }
            });
        }

        function renderTable(movies) {
            const tableBody = document.querySelector('#movieTable tbody');
            tableBody.innerHTML = '';
            
            if (movies.length === 0) {
                const noResultsRow = document.createElement('tr');
                noResultsRow.innerHTML = `
                    <td colspan="7" style="text-align: center; padding: 40px;">
                        <div style="color: #666; font-size: 16px;">
                            No encontramos lo que estabas buscando üòï
                            <br>
                            <button onclick="resetTable()" style="margin-top: 15px; padding: 8px 15px; background: #8ac0ff; border: none; color: white; border-radius: 4px; cursor: pointer;">
                                Ver todas las pel√≠culas
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(noResultsRow);
                return;
            }
            
            movies.forEach((movie, index) => {
                const row = document.createElement('tr');
                const movieClass = movie.isNew ? 'new-movie' : '';
                const tagsHtml = movie.tags.map(tag => 
                    `<a href="#" class="tag-link" onclick="filterByTag('${tag}')">${tag}</a>`
                ).join(' ');
                
                row.innerHTML = `
                    <td class="${movieClass}">${movie.title}</td>
                    <td><a href="#" class="year-link" onclick="filterByYear(${movie.year})">${movie.year}</a></td>
                    <td>${movie.duration ? movie.duration + "'" : ''}</td>
                    <td>${formatDirectors(movie.director)}</td>
                    <td>${tagsHtml}</td>
                    <td><a href="${movie.movieLink}" class="movie-link" target="_blank">Ver</a></td>
                    <td><a href="${movie.letterboxdLink}" class="letterboxd-link" target="_blank">Letterboxd</a></td>
                `;
                tableBody.appendChild(row);
            });
        }

        function searchMovies() {
            const query = document.getElementById('searchInput').value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            currentFilter = { type: 'search', value: query };
            const filteredMovies = movieData.filter(movie =>
                movie.title.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").includes(query) ||
                movie.director.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").includes(query) ||
                movie.year.toString().includes(query) ||
                movie.tags.some(tag => tag.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").includes(query))
            );
            renderTable(filteredMovies);
            if (currentView === 'gallery') {
                renderGallery(filteredMovies);
            }
            // El bot√≥n 'Volver' ahora se maneja en renderGallery
        }

        function filterByTag(tag) {
            event.preventDefault();
            currentFilter = { type: 'tag', value: tag };
            const filteredMovies = movieData.filter(movie => movie.tags.includes(tag));
            renderTable(filteredMovies);
            if (currentView === 'gallery') {
                renderGallery(filteredMovies);
            }
            // El bot√≥n 'Volver' ahora se maneja en renderGallery
        }

        function openRandomMovie() {
            if (movieData.length > 0) {
                const randomIndex = Math.floor(Math.random() * movieData.length);
                const randomMovie = movieData[randomIndex];
                window.open(randomMovie.movieLink, '_blank');
            }
        }

        function showInfo() {
            const popup = document.getElementById('infoPopup');
            popup.style.display = 'flex';
            setTimeout(() => popup.classList.add('visible'), 10);
        }

        function closeInfo() {
            const popup = document.getElementById('infoPopup');
            popup.classList.remove('visible');
            setTimeout(() => popup.style.display = 'none', 300);
        }

        function showMoviePopup(movie, card) {
            const popup = document.getElementById('moviePopup');
            const posterImg = card.querySelector('.movie-poster');
            const synopsis = posterImg.getAttribute('data-synopsis') || 'Sinopsis no disponible.';
            
            // Llenar informaci√≥n del popup
            document.querySelector('.movie-popup-title').textContent = movie.title;
            document.querySelector('.movie-popup-year').innerHTML = `<a href="#" class="popup-link-year">${movie.year}</a>`;
            document.querySelector('.movie-popup-duration').innerHTML = movie.duration ? `<a href="#" style="text-decoration:none;cursor:default;">${movie.duration}'</a>` : '';
            document.querySelector('.movie-popup-director').innerHTML = `<a href="#" class="popup-link-director">${movie.director}</a>`;
            document.querySelector('.synopsis-text').textContent = synopsis;
            
            // Copiar poster al popup
            const popupPosterImg = document.querySelector('.movie-popup-poster-img');
            if (posterImg.style.backgroundImage) {
                popupPosterImg.style.backgroundImage = posterImg.style.backgroundImage;
            } else {
                popupPosterImg.style.backgroundImage = 'none';
                popupPosterImg.style.backgroundColor = '#f0f0f0';
            }
            
            // Configurar enlaces
            document.querySelector('.movie-popup-watch').href = movie.movieLink;
            document.querySelector('.movie-popup-letterboxd').href = movie.letterboxdLink;
            
            // Eventos para filtrar por a√±o o director
            setTimeout(() => {
                document.querySelector('.popup-link-year').onclick = function(e) {
                    e.preventDefault();
                    closeMoviePopup();
                    filterGalleryByYear(movie.year);
                };
                document.querySelector('.popup-link-director').onclick = function(e) {
                    e.preventDefault();
                    closeMoviePopup();
                    filterGalleryByDirector(movie.director);
                };
            }, 10);
            
            // Mostrar popup
            popup.style.display = 'flex';
            setTimeout(() => popup.classList.add('visible'), 10);
        }

        function filterGalleryByYear(year) {
            currentFilter = { type: 'year', value: year };
            const filtered = movieData.filter(m => m.year === year);
            renderGallery(filtered);
            document.getElementById('resetButton').style.display = 'inline';
        }
        function filterGalleryByDirector(director) {
            currentFilter = { type: 'director', value: director };
            const filtered = movieData.filter(m => m.director === director);
            renderGallery(filtered);
            document.getElementById('resetButton').style.display = 'inline';
        }

        function closeMoviePopup() {
            const popup = document.getElementById('moviePopup');
            popup.classList.remove('visible');
            setTimeout(() => popup.style.display = 'none', 300);
        }

        function formatDirectors(directors) {
            return directors
                .split(/\s+[y&,]\s+|\s*,\s*/g)
                .filter(director => director.trim() !== '')
                .map(director => {
                    const cleanDirector = director.trim();
                    return `<a href="#" class="director-link" onclick="filterByDirector('${cleanDirector}')">${cleanDirector}</a>`;
                })
                .join(' y ');
        }

        function filterByDirector(director) {
            event.preventDefault();
            currentFilter = { type: 'director', value: director };
            const filteredMovies = movieData.filter(movie => {
                const movieDirectors = movie.director
                    .split(/\s+[y&,]\s+|\s*,\s*/g)
                    .map(d => d.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, ""))
                    .filter(d => d !== '');
                const searchDirector = director.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                return movieDirectors.includes(searchDirector);
            });
            renderTable(filteredMovies);
            if (currentView === 'gallery') {
                renderGallery(filteredMovies);
            }
            // El bot√≥n 'Volver' ahora se maneja en renderGallery
        }

        function filterByYear(year) {
            event.preventDefault();
            const filteredMovies = movieData.filter(movie => movie.year === year);
            renderTable(filteredMovies);
            if (currentView === 'gallery') {
                renderGallery(filteredMovies);
            }
            document.getElementById('resetButton').style.display = 'inline';
        }

        function resetTable() {
            document.getElementById('searchInput').value = '';
            currentFilter = { type: null, value: null };
            renderTable(movieData);
            if (currentView === 'gallery') {
                renderGallery(movieData);
            }
            document.getElementById('resetButton').style.display = 'none';
            currentSort.column = null;
            currentSort.clicks = 0;
            updateSortArrows(null);
        }

        function resetGallery() {
            renderGallery(movieData);
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function debugPosters() {
            console.log('Debugging posters...');
            if (currentView === 'gallery') {
                const movieCards = document.querySelectorAll('.movie-card');
                movieCards.forEach((card, index) => {
                    const letterboxdLink = card.querySelector('.movie-poster').dataset.letterboxd;
                    console.log(`Card ${index + 1}: Loading poster for ${letterboxdLink}`);
                    loadPosterFromLetterboxd(letterboxdLink, card.querySelector('.movie-poster'));
                });
            } else {
                console.log('Cambia a vista de galer√≠a para debuggear posters');
            }
        }

        function testLetterboxdUrls() {
            console.log('=== PRUEBA DE URLs DE LETTERBOXD ===');
            // Probar con una pel√≠cula conocida
            const testUrls = [
                'https://a.ltrbxd.com/resized/film-poster/parasite-2019-0-600-0-900-crop.jpg',
                'https://a.ltrbxd.com/resized/film-poster/the-shawshank-redemption-0-600-0-900-crop.jpg',
                'https://a.ltrbxd.com/resized/film-poster/pulp-fiction-0-600-0-900-crop.jpg'
            ];
        }

        function closeMobileMenu() {
            document.getElementById('mobileMenu').classList.remove('open');
            document.getElementById('mobileMenuBg').classList.remove('open');
        }
        function openMobileMenu() {
            document.getElementById('mobileMenu').classList.add('open');
            document.getElementById('mobileMenuBg').classList.add('open');
        }
        // Mostrar/ocultar men√∫ hamburguesa seg√∫n tama√±o
        function handleResizeMenu() {
            if(window.innerWidth <= 600) {
                document.getElementById('hamburgerBtn').style.display = 'block';
                document.querySelector('.header-buttons').style.display = 'none';
                document.getElementById('mobileMenu').style.display = '';
                document.getElementById('mobileMenuBg').style.display = '';
            } else {
                document.getElementById('hamburgerBtn').style.display = 'none';
                document.querySelector('.header-buttons').style.display = 'flex';
                document.getElementById('mobileMenu').style.display = 'none';
                document.getElementById('mobileMenuBg').style.display = 'none';
                closeMobileMenu();
            }
        }
        window.addEventListener('resize', handleResizeMenu);
        window.addEventListener('DOMContentLoaded', handleResizeMenu);
        document.getElementById('hamburgerBtn').onclick = openMobileMenu;
        document.getElementById('mobileMenuBg').onclick = closeMobileMenu;
        // Cerrar men√∫ al elegir opci√≥n (ya est√° en el onclick de cada bot√≥n)

        // Renderizar tarjetas de lista en m√≥vil
        function renderMobileListCards(movies) {
          const tableView = document.getElementById('tableView');
          let cardsDiv = tableView.querySelector('.mobile-list-cards');
          if (!cardsDiv) {
            cardsDiv = document.createElement('div');
            cardsDiv.className = 'mobile-list-cards';
            tableView.appendChild(cardsDiv);
          }
          cardsDiv.innerHTML = '';
          movies.forEach(movie => {
            const card = document.createElement('div');
            card.className = 'mobile-list-card';
            card.innerHTML = `
              <div class="ml-main">
                <div class="ml-title">${movie.title}</div>
                <div class="ml-meta">${movie.year}${movie.duration ? " ‚Ä¢ " + movie.duration + "'" : ''}</div>
                <div class="ml-meta">${movie.director}</div>
                <div class="ml-meta">${movie.tags.slice(0, 3).map(tag => `<span class='movie-tag'>${tag}</span>`).join('')}</div>
              </div>
              <div class="ml-actions">
                <a href="${movie.movieLink}" target="_blank">Ver</a>
                <a href="${movie.letterboxdLink}" target="_blank">Letterboxd</a>
              </div>
            `;
            cardsDiv.appendChild(card);
          });
        }

        // Llamar a renderMobileListCards cuando se renderiza la tabla
        const originalRenderTable = renderTable;
        renderTable = function(movies) {
          const tableBody = document.querySelector('#movieTable tbody');
          tableBody.innerHTML = '';
          movies.forEach((movie, index) => {
            const row = document.createElement('tr');
            const movieClass = movie.isNew ? 'new-movie' : '';
            const tagsHtml = movie.tags.map(tag => 
              `<a href=\"#\" class=\"tag-link\" onclick=\"filterByTag('${tag}')\">${tag}</a>`
            ).join(' ');
            row.innerHTML = `
              <td class="${movieClass}">${movie.title}</td>
              <td><a href=\"#\" class=\"year-link\" onclick=\"filterByYear(${movie.year})\">${movie.year}</a></td>
              <td>${movie.duration ? movie.duration + "'" : ''}</td>
              <td>${formatDirectors(movie.director)}</td>
              <td>${tagsHtml}</td>
              <td><a href="${movie.movieLink}" class="movie-link" target="_blank">Ver</a></td>
              <td><a href="${movie.letterboxdLink}" class="letterboxd-link" target="_blank">Letterboxd</a></td>
            `;
            tableBody.appendChild(row);
          });
          // NUEVO: renderizar tarjetas para m√≥vil
          renderMobileListCards(movies);
        }

        function applyGalleryOrder() {
            let select = document.getElementById('galleryOrderSelectDesktop');
            if (window.innerWidth <= 600) {
                select = document.getElementById('galleryOrderSelectMobile');
            }
            const value = select.value;
            let movies = filteredMovies.length ? [...filteredMovies] : [...movieData];
            switch (value) {
                case 'az-title':
                    movies.sort((a, b) => a.title.localeCompare(b.title));
                    break;
                case 'az-director':
                    movies.sort((a, b) => a.director.localeCompare(b.director));
                    break;
                case 'year-asc':
                    movies.sort((a, b) => a.year - b.year);
                    break;
                case 'year-desc':
                    movies.sort((a, b) => b.year - a.year);
                    break;
                case 'duration-asc':
                    movies.sort((a, b) => {
                        const dA = a.duration ? parseInt(a.duration) : 0;
                        const dB = b.duration ? parseInt(b.duration) : 0;
                        return dA - dB;
                    });
                    break;
                case 'duration-desc':
                    movies.sort((a, b) => {
                        const dA = a.duration ? parseInt(a.duration) : 0;
                        const dB = b.duration ? parseInt(b.duration) : 0;
                        return dB - dA;
                    });
                    break;
            }
            renderGallery(movies);
        }

        // MODO OSCURO
        function setDarkMode(enabled) {
            if (enabled) {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeBtn').textContent = '‚òÄÔ∏è Claro';
                var btnMobile = document.getElementById('darkModeBtnMobile');
                if(btnMobile) btnMobile.textContent = '‚òÄÔ∏è Claro';
                localStorage.setItem('darkMode', '1');
            } else {
                document.body.classList.remove('dark-mode');
                document.getElementById('darkModeBtn').textContent = 'üåô Oscuro';
                var btnMobile = document.getElementById('darkModeBtnMobile');
                if(btnMobile) btnMobile.textContent = 'üåô Oscuro';
                localStorage.setItem('darkMode', '0');
            }
        }
        function toggleDarkMode() {
            const isDark = document.body.classList.contains('dark-mode');
            setDarkMode(!isDark);
        }
        // Al cargar la p√°gina, aplicar preferencia guardada
        window.addEventListener('DOMContentLoaded', function() {
            const darkPref = localStorage.getItem('darkMode');
            setDarkMode(darkPref === '1');
        });

        // Opciones completas y abreviadas para el select m√≥vil
        const filterOptionsFull = [
            { value: 'az-title', text: 'Orden alfab√©tico por pel√≠cula (A-Z)' },
            { value: 'az-director', text: 'Orden alfab√©tico por director (A-Z)' },
            { value: 'year-asc', text: 'A√±o (ascendente)' },
            { value: 'year-desc', text: 'A√±o (descendente)' },
            { value: 'duration-asc', text: 'Duraci√≥n (ascendente)' },
            { value: 'duration-desc', text: 'Duraci√≥n (descendente)' }
        ];
        const filterOptionsShort = [
            { value: 'az-title', text: 'üîΩ' },
            { value: 'az-director', text: 'Dir' },
            { value: 'year-asc', text: 'A‚Üë' },
            { value: 'year-desc', text: 'A‚Üì' },
            { value: 'duration-asc', text: 'D‚Üë' },
            { value: 'duration-desc', text: 'D‚Üì' }
        ];

        function setMobileFilterOptions(full) {
            const select = document.getElementById('galleryOrderSelectMobile');
            if (!select) return;
            const options = full ? filterOptionsFull : filterOptionsShort;
            const currentValue = select.value;
            select.innerHTML = '';
            options.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt.value;
                option.textContent = opt.text;
                if (opt.value === currentValue) option.selected = true;
                select.appendChild(option);
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            const select = document.getElementById('galleryOrderSelectMobile');
            if (select) {
                select.addEventListener('focus', function() { setMobileFilterOptions(true); });
                select.addEventListener('blur', function() { setMobileFilterOptions(false); });
            }
        });
    </script>
</body>
</html>
